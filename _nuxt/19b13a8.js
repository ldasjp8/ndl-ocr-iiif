(window.webpackJsonp=window.webpackJsonp||[]).push([[24],{1204:function(t,e,n){var o=n(526),r=n(1205),c=n(528),l=n(1210),f=c((function(t,e){if(null==t)return[];var n=e.length;return n>1&&l(t,e[0],e[1])?e=[]:n>2&&l(e[0],e[1],e[2])&&(e=[e[0]]),r(t,o(e,1),[])}));t.exports=f},1205:function(t,e,n){var o=n(502),r=n(525),c=n(552),l=n(1206),f=n(1207),d=n(548),h=n(1208),v=n(527),y=n(466);t.exports=function(t,e,n){e=e.length?o(e,(function(t){return y(t)?function(e){return r(e,1===t.length?t[0]:t)}:t})):[v];var w=-1;e=o(e,d(c));var m=l(t,(function(t,n,r){return{criteria:o(e,(function(e){return e(t)})),index:++w,value:t}}));return f(m,(function(object,t){return h(object,t,n)}))}},1206:function(t,e,n){var o=n(656),r=n(504);t.exports=function(t,e){var n=-1,c=r(t)?Array(t.length):[];return o(t,(function(t,o,r){c[++n]=e(t,o,r)})),c}},1207:function(t,e){t.exports=function(t,e){var n=t.length;for(t.sort(e);n--;)t[n]=t[n].value;return t}},1208:function(t,e,n){var o=n(1209);t.exports=function(object,t,e){for(var n=-1,r=object.criteria,c=t.criteria,l=r.length,f=e.length;++n<l;){var d=o(r[n],c[n]);if(d)return n>=f?d:d*("desc"==e[n]?-1:1)}return object.index-t.index}},1209:function(t,e,n){var o=n(524);t.exports=function(t,e){if(t!==e){var n=void 0!==t,r=null===t,c=t==t,l=o(t),f=void 0!==e,d=null===e,h=e==e,v=o(e);if(!d&&!v&&!l&&t>e||l&&f&&h&&!d&&!v||r&&f&&h||!n&&h||!c)return 1;if(!r&&!l&&!v&&t<e||v&&n&&c&&!r&&!l||d&&n&&c||!f&&c||!h)return-1}return 0}},1210:function(t,e,n){var o=n(582),r=n(504),c=n(547),l=n(475);t.exports=function(t,e,object){if(!l(object))return!1;var n=typeof e;return!!("number"==n?r(object)&&c(e,object.length):"string"==n&&e in object)&&o(object[e],t)}},1211:function(t,e,n){var o=n(633),r=n(528),c=n(1212),l=n(590),f=r((function(t){return c(o(t,l))}));t.exports=f},1212:function(t,e,n){var o=n(655),r=n(526),c=n(780);t.exports=function(t,e,n){var l=t.length;if(l<2)return l?c(t[0]):[];for(var f=-1,d=Array(l);++f<l;)for(var h=t[f],v=-1;++v<l;)v!=f&&(d[f]=o(d[f]||h,t[v],e,n));return c(r(d,1),e,n)}},1293:function(t,e,n){"use strict";n.r(e);var o=n(442),r=n(445),c=n(1308),l=n(449),f=n(467),d=n.n(f),h=n(443),v=n(438),y=n.n(v),w=n(600),m=n.n(w),O=n(562),A=n.n(O),j=n(605),x=n.n(j),I=n(441),C=n.n(I),k=n(458),S=n(459),P=n.n(S),R=n(1204),T=n.n(R),M=n(1211),W=n.n(M);function E(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var D=function(){function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.viewer=e,this.ref=n,this.containerWidth=0,this.containerHeight=0,this.imgAspectRatio=1}var e,n,o;return e=t,(n=[{key:"canvas",get:function(){return this.canvasDiv.firstElementChild}},{key:"canvasDiv",get:function(){return this.ref.current}},{key:"context2d",get:function(){return this.canvas.getContext("2d")}},{key:"clear",value:function(){this.context2d.clearRect(0,0,this.containerWidth,this.containerHeight)}},{key:"resize",value:function(){this.containerWidth!==this.viewer.container.clientWidth&&(this.containerWidth=this.viewer.container.clientWidth,this.canvasDiv.setAttribute("width",this.containerWidth),this.canvas.setAttribute("width",this.containerWidth)),this.containerHeight!==this.viewer.container.clientHeight&&(this.containerHeight=this.viewer.container.clientHeight,this.canvasDiv.setAttribute("height",this.containerHeight),this.canvas.setAttribute("height",this.containerHeight)),this.viewportOrigin=new x.a.Point(0,0);var t=this.viewer.viewport.getBoundsNoRotate(!0);this.viewportOrigin.x=t.x,this.viewportOrigin.y=t.y*this.imgAspectRatio,this.viewportWidth=t.width,this.viewportHeight=t.height*this.imgAspectRatio;var e=this.viewer.world.getItemAt(0);e&&(this.imgWidth=e.source.dimensions.x,this.imgHeight=e.source.dimensions.y,this.imgAspectRatio=this.imgWidth/this.imgHeight)}},{key:"canvasUpdate",value:function(t){var e=this.viewer.viewport.getZoom(!0),n=this.viewer.world.getItemAt(0);if(n){var o=n.viewportToImageZoom(e),r=(this.viewportOrigin.x/this.imgWidth-this.viewportOrigin.x)/this.viewportWidth*this.containerWidth,c=(this.viewportOrigin.y/this.imgHeight-this.viewportOrigin.y)/this.viewportHeight*this.containerHeight;this.clearBeforeRedraw&&this.clear(),this.context2d.translate(r,c),this.context2d.scale(o,o);var l=this.viewer.viewport.getCenter();this.viewer.viewport.getFlip()&&(this.context2d.translate(2*l.x,0),this.context2d.scale(-1,1));var f=this.viewer.viewport.getRotation();0!==f&&(this.context2d.translate(l.x,l.y),this.context2d.rotate(f*Math.PI/180),this.context2d.translate(-1*l.x,-1*l.y)),t(),this.context2d.setTransform(1,0,0,1,0,0)}}}])&&E(e.prototype,n),o&&E(e,o),t}();function H(t){return function(t){if(Array.isArray(t))return z(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return z(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return z(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function z(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}function V(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var U=function(){function t(e){var n=e.resource,o=e.palette,r=e.zoomRatio,c=e.offset,l=e.selected,f=e.hovered;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.resource=n,this.palette=o,this.zoomRatio=r,this.offset=c,this.selected=l,this.hovered=f}var e,n,o;return e=t,(n=[{key:"toContext",value:function(t){this.context=t,this.resource.svgSelector?this.svgContext():this.resource.fragmentSelector&&this.fragmentContext()}},{key:"svgString",get:function(){return this.resource.svgSelector.value}},{key:"svgContext",value:function(){var t,e=this;0!==(t=this.hovered?this.palette.hovered:this.selected?this.palette.selected:this.palette.default).globalAlpha&&H(this.svgPaths).forEach((function(element){e.context.save(),e.context.translate(e.offset.x,e.offset.y);var p=new Path2D(element.attributes.d.nodeValue);e.context.strokeStyle=e.color,element.attributes["stroke-dasharray"]&&e.context.setLineDash(element.attributes["stroke-dasharray"].nodeValue.split(","));var n={fill:"fillStyle",stroke:"strokeStyle","stroke-dashoffset":"lineDashOffset","stroke-linecap":"lineCap","stroke-linejoin":"lineJoin","stroke-miterlimit":"miterlimit","stroke-width":"lineWidth"};Object.keys(n).forEach((function(t){element.attributes[t]&&(e.context[n[t]]=element.attributes[t].nodeValue)})),e.context.lineWidth/=e.zoomRatio,(e.selected||e.hovered)&&(e.context.strokeStyle=t.strokeStyle||t.fillStyle),element.attributes["stroke-opacity"]?e.context.globalAlpha=t.globalAlpha*element.attributes["stroke-opacity"].nodeValue:e.context.globalAlpha=t.globalAlpha,e.context.stroke(p),element.attributes.fill&&"none"!==element.attributes.fill.nodeValue&&(element.attributes["fill-opacity"]?e.context.globalAlpha=t.globalAlpha*element.attributes["fill-opacity"].nodeValue:e.context.globalAlpha=t.globalAlpha,e.context.fill(p)),e.context.restore()}))}},{key:"fragmentContext",value:function(){var t,e,n,o=this,r=this.resource.fragmentSelector;(r[0]+=this.offset.x,r[1]+=this.offset.y,t=this.selected?this.palette.selected:this.hovered?this.palette.hovered:this.palette.default,this.context.save(),Object.keys(t).forEach((function(e){o.context[e]=t[e]})),0!==t.globalAlpha)&&(t.fillStyle?(e=this.context).fillRect.apply(e,H(r)):(this.context.lineWidth=1/this.zoomRatio,(n=this.context).strokeRect.apply(n,H(r))),this.context.restore())}},{key:"svgPaths",get:function(){return(new DOMParser).parseFromString(this.svgString,"text/xml").getElementsByTagName("path")}}])&&V(e.prototype,n),o&&V(e,o),t}();function _(object,t){var e=Object.keys(object);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(object);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(object,t).enumerable}))),e.push.apply(e,n)}return e}function B(t){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?_(Object(source),!0).forEach((function(e){F(t,e,source[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(source)):_(Object(source)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(source,e))}))}return t}function F(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function N(t){return function(t){if(Array.isArray(t))return $(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||J(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Z(t,i){return function(t){if(Array.isArray(t))return t}(t)||function(t,i){var e=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==e)return;var n,o,r=[],c=!0,l=!1;try{for(e=e.call(t);!(c=(n=e.next()).done)&&(r.push(n.value),!i||r.length!==i);c=!0);}catch(t){l=!0,o=t}finally{try{c||null==e.return||e.return()}finally{if(l)throw o}}return r}(t,i)||J(t,i)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function J(t,e){if(t){if("string"==typeof t)return $(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?$(t,e):void 0}}function $(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}function X(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Y(t,p){return Y=Object.setPrototypeOf||function(t,p){return t.__proto__=p,t},Y(t,p)}function L(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,o=Q(t);if(e){var r=Q(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return G(this,n)}}function G(t,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return K(t)}function K(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Q(t){return Q=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Q(t)}var tt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Y(t,e)}(c,t);var e,n,o,r=L(c);function c(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,c),(e=r.call(this,t)).ref=y.a.createRef(),e.osdCanvasOverlay=null,e.updateCanvas=function(){},e.onUpdateViewport=e.onUpdateViewport.bind(K(e)),e.onCanvasClick=e.onCanvasClick.bind(K(e)),e.onCanvasMouseMove=m()(e.onCanvasMouseMove.bind(K(e)),10),e.onCanvasExit=e.onCanvasExit.bind(K(e)),e}return e=c,o=[{key:"annotationsMatch",value:function(t,e){return!t&&!e||!(t&&!e||!t&&e)&&(0===t.length&&0===e.length||t.length===e.length&&t.every((function(t,n){var o=t.resources.map((function(t){return t.id})),r=e[n].resources.map((function(t){return t.id}));return 0===o.length&&0===r.length||o.length===r.length&&!(t.id!==e[n].id||!A()(o,r))})))}}],(n=[{key:"componentDidMount",value:function(){this.initializeViewer()}},{key:"componentDidUpdate",value:function(t){var e=this.props,n=e.drawAnnotations,o=e.drawSearchAnnotations,r=e.annotations,l=e.searchAnnotations,f=e.hoveredAnnotationIds,d=e.selectedAnnotationId,h=e.highlightAllAnnotations,v=e.viewer;this.initializeViewer();var y=!c.annotationsMatch(r,t.annotations),w=!c.annotationsMatch(l,t.searchAnnotations),m=W()(f,t.hoveredAnnotationIds).length>0;this.osdCanvasOverlay&&m&&(f.length>0?this.osdCanvasOverlay.canvasDiv.style.cursor="pointer":this.osdCanvasOverlay.canvasDiv.style.cursor="");var O=d!==t.selectedAnnotationId,A=n!==t.drawAnnotations||o!==t.drawSearchAnnotations||h!==t.highlightAllAnnotations;(w||y||O||m||A)&&(this.updateCanvas=this.canvasUpdateCallback(),v.forceRedraw())}},{key:"componentWillUnmount",value:function(){var t=this.props.viewer;t.removeHandler("canvas-click",this.onCanvasClick),t.removeHandler("canvas-exit",this.onCanvasExit),t.removeHandler("update-viewport",this.onUpdateViewport),t.removeHandler("mouse-move",this.onCanvasMouseMove)}},{key:"onCanvasClick",value:function(t){var e=this,n=this.props.canvasWorld,o=t.position,r=t.eventSource.viewport.pointFromPixel(o),canvas=n.canvasAtPoint(r);if(canvas){var c=Z(n.canvasToWorldCoordinates(canvas.id),4),l=(c[0],c[1],c[2]),f=c[3],d=this.annotationsAtPoint(canvas,r);if(d.length>0&&(t.preventDefaultAction=!0),1===d.length)this.toggleAnnotation(d[0].id);else if(d.length>0){var h=function(t){var n=Math.PI/180;return function(o){for(var c=0,l=0;l<360;l+=1){var f=Math.cos(l*n)*t+r.x,d=Math.sin(l*n)*t+r.y;e.isAnnotationAtPoint(o,canvas,{x:f,y:d})&&(c+=1)}return{anno:o,score:c}}},v=[],y=1;for(v=T()(d.map(h(y)),"score");y<Math.max(l,f)&&v[0].score===v[1].score;)y*=2,v=T()(d.map(h(y)),"score");this.toggleAnnotation(v[0].anno.id)}}}},{key:"onCanvasMouseMove",value:function(t){var e=this.props,n=e.annotations,o=e.canvasWorld,r=e.hoverAnnotation,c=e.hoveredAnnotationIds,l=e.searchAnnotations,f=e.viewer,d=e.windowId;if(0!==n.length||0!==l.length){var h=t.position,v=f.viewport.pointFromPixel(h),canvas=o.canvasAtPoint(v);if(canvas){var y=this.annotationsAtPoint(canvas,v);W()(c,y.map((function(a){return a.id}))).length>0&&r(d,y.map((function(a){return a.id})))}else r(d,[])}}},{key:"onCanvasExit",value:function(t){var e=this.props,n=e.hoverAnnotation,o=e.windowId;this.onCanvasMouseMove.cancel(),n(o,[])}},{key:"onUpdateViewport",value:function(t){this.updateCanvas()}},{key:"initializeViewer",value:function(){var t=this.props.viewer;t&&(this.osdCanvasOverlay||(this.osdCanvasOverlay=new D(t,this.ref),t.addHandler("canvas-click",this.onCanvasClick),t.addHandler("canvas-exit",this.onCanvasExit),t.addHandler("update-viewport",this.onUpdateViewport),t.addHandler("mouse-move",this.onCanvasMouseMove),this.updateCanvas=this.canvasUpdateCallback()))}},{key:"canvasUpdateCallback",value:function(){var t=this;return function(){t.osdCanvasOverlay.clear(),t.osdCanvasOverlay.resize(),t.osdCanvasOverlay.canvasUpdate(t.renderAnnotations.bind(t))}}},{key:"isAnnotationAtPoint",value:function(t,canvas,e){var n=Z(this.props.canvasWorld.canvasToWorldCoordinates(canvas.id),2),o=n[0],r=n[1],c=e.x-o,l=e.y-r;if(t.svgSelector){var f=this.osdCanvasOverlay.context2d;return N(new U({resource:t}).svgPaths).some((function(path){return f.isPointInPath(new Path2D(path.attributes.d.nodeValue),c,l)}))}if(t.fragmentSelector){var d=Z(t.fragmentSelector,4),h=d[0],v=d[1],y=d[2],w=d[3];return h<=c&&c<=h+y&&v<=l&&l<=v+w}return!1}},{key:"annotationsAtPoint",value:function(canvas,t){var e=this,n=this.props,o=n.annotations,r=n.searchAnnotations,c=[].concat(N(o),N(r));return d()(c.map((function(t){return t.resources}))).filter((function(n){return canvas.id===n.targetId&&e.isAnnotationAtPoint(n,canvas,t)}))}},{key:"toggleAnnotation",value:function(t){var e=this.props,n=e.selectedAnnotationId,o=e.selectAnnotation,r=e.deselectAnnotation,c=e.windowId;n===t?r(c,t):o(c,t)}},{key:"annotationsToContext",value:function(t,e){var n=this.props,o=n.highlightAllAnnotations,r=n.hoveredAnnotationIds,c=n.selectedAnnotationId,l=n.canvasWorld,f=n.viewer,d=this.osdCanvasOverlay.context2d,h=f.viewport.getZoom(!0)/f.viewport.getMaxZoom();t.forEach((function(t){t.resources.forEach((function(t){if(l.canvasIds.includes(t.targetId)){var n=l.offsetByCanvas(t.targetId);new U({hovered:r.includes(t.id),offset:n,palette:B(B({},e),{},{default:B(B({},e.default),!o&&e.hidden)}),resource:t,selected:c===t.id,zoomRatio:h}).toContext(d)}}))}))}},{key:"renderAnnotations",value:function(){var t=this.props,e=t.annotations,n=t.drawAnnotations,o=t.drawSearchAnnotations,r=t.searchAnnotations,c=t.palette;o&&this.annotationsToContext(r,c.search),n&&this.annotationsToContext(e,c.annotations)}},{key:"render",value:function(){var t=this.props.viewer;return t?P.a.createPortal(y.a.createElement("div",{ref:this.ref,style:{height:"100%",left:0,position:"absolute",top:0,width:"100%"}},y.a.createElement("canvas",null)),t.canvas):y.a.createElement(y.a.Fragment,null)}}])&&X(e.prototype,n),o&&X(e,o),c}(v.Component);tt.defaultProps={annotations:[],deselectAnnotation:function(){},drawAnnotations:!0,drawSearchAnnotations:!0,highlightAllAnnotations:!1,hoverAnnotation:function(){},hoveredAnnotationIds:[],palette:{},searchAnnotations:[],selectAnnotation:function(){},selectedAnnotationId:void 0,viewer:null};var et=n(752),nt=n(850),ot=n(802),it=n(531),at=n(591),st=n(483),ct=n(760),lt={deselectAnnotation:et.a,hoverAnnotation:et.b,selectAnnotation:et.g},ut=Object(o.compose)(Object(c.a)(),Object(r.b)((function(t,e){var n=e.windowId;return{annotations:Object(nt.d)(t,{windowId:n}),canvasWorld:Object(ot.a)(t,{windowId:n}),drawAnnotations:Object(it.a)(t).window.forceDrawAnnotations||Object(at.e)(t,{content:"annotations",windowId:n}).length>0,drawSearchAnnotations:Object(it.a)(t).window.forceDrawAnnotations||Object(at.e)(t,{content:"search",windowId:n}).length>0,highlightAllAnnotations:Object(st.e)(t,{windowId:n}).highlightAllAnnotations,hoveredAnnotationIds:Object(st.e)(t,{windowId:n}).hoveredAnnotationIds,palette:Object(it.g)(t).palette,searchAnnotations:Object(ct.f)(t,{windowId:n}),selectedAnnotationId:Object(nt.e)(t,{windowId:n})}}),lt),Object(h.a)("AnnotationsOverlay"))(tt),ft=n(469),ht={get:function(t){return this.refs[t]},refs:{},set:function(t,e){this.refs[t]=e}};function vt(t,e,n){return vt=xt()?Reflect.construct:function(t,e,n){var a=[null];a.push.apply(a,e);var o=new(Function.bind.apply(t,a));return n&&Ot(o,n.prototype),o},vt.apply(null,arguments)}function pt(t){return function(t){if(Array.isArray(t))return gt(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return gt(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return gt(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function gt(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}function yt(object,t){var e=Object.keys(object);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(object);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(object,t).enumerable}))),e.push.apply(e,n)}return e}function wt(t){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?yt(Object(source),!0).forEach((function(e){mt(t,e,source[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(source)):yt(Object(source)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(source,e))}))}return t}function mt(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function bt(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Ot(t,p){return Ot=Object.setPrototypeOf||function(t,p){return t.__proto__=p,t},Ot(t,p)}function At(t,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return jt(t)}function jt(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function xt(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function It(t){return It=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},It(t)}var Ct=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Ot(t,e)}(f,t);var e,n,o,r,c,l=(e=f,n=xt(),function(){var t,o=It(e);if(n){var r=It(this).constructor;t=Reflect.construct(o,arguments,r)}else t=o.apply(this,arguments);return At(this,t)});function f(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,f),(e=l.call(this,t)).state={viewer:void 0},e.ref=y.a.createRef(),e.apiRef=y.a.createRef(),ht.set(t.windowId,e.apiRef),e.onCanvasMouseMove=m()(e.onCanvasMouseMove.bind(jt(e)),10),e.onViewportChange=e.onViewportChange.bind(jt(e)),e.zoomToWorld=e.zoomToWorld.bind(jt(e)),e.osdUpdating=!1,e}return o=f,r=[{key:"componentDidMount",value:function(){var t=this,e=this.props,n=e.osdConfig,o=e.t,r=e.windowId;if(this.ref.current){var c=new x.a(wt({id:this.ref.current.id},n)),canvas=c.canvas&&c.canvas.firstElementChild;canvas&&(canvas.setAttribute("role","img"),canvas.setAttribute("aria-label",o("digitizedView")),canvas.setAttribute("aria-describedby","".concat(r,"-osd"))),this.apiRef.current=c,this.setState({viewer:c}),c.addHandler("animation-start",(function(){t.osdUpdating=!0})),c.addHandler("animation-finish",this.onViewportChange),c.addHandler("animation-finish",(function(){t.osdUpdating=!1})),c.innerTracker&&(c.innerTracker.moveHandler=this.onCanvasMouseMove)}}},{key:"componentDidUpdate",value:function(t,e){var n=this.props,o=n.viewerConfig,r=n.canvasWorld,c=this.state.viewer;if(this.apiRef.current=c,void 0===e.viewer)return o&&(c.viewport.panTo(o,!0),c.viewport.zoomTo(o.zoom,o,!0),void 0!==o.degrees&&c.viewport.setRotation(o.degrees),void 0!==o.flip&&c.viewport.setFlip(o.flip)),void this.addAllImageSources(!o);if(this.infoResponsesMatch(t.infoResponses)&&this.nonTiledImagedMatch(t.nonTiledImages))if(A()(r.layers,t.canvasWorld.layers)){if(o&&!this.osdUpdating){var l=c.viewport;o.x===l.centerSpringX.target.value&&o.y===l.centerSpringY.target.value||l.panTo(o,!1),o.zoom!==l.zoomSpring.target.value&&l.zoomTo(o.zoom,o,!1),o.rotation!==l.getRotation()&&l.setRotation(o.rotation),o.flip!==l.getFlip()&&l.setFlip(o.flip)}}else this.refreshTileProperties();else{c.close();var f=!A()(r.canvasIds,t.canvasWorld.canvasIds);this.addAllImageSources(f||!o)}}},{key:"componentWillUnmount",value:function(){var t=this.state.viewer;t.innerTracker&&t.innerTracker.moveHandler===this.onCanvasMouseMove&&(t.innerTracker.moveHandler=null),t.removeAllHandlers(),this.apiRef.current=void 0}},{key:"onCanvasMouseMove",value:function(t){this.state.viewer.raiseEvent("mouse-move",t)}},{key:"onViewportChange",value:function(t){var e=this.props,n=e.updateViewport,o=e.windowId,r=t.eventSource.viewport;n(o,{flip:r.getFlip(),rotation:r.getRotation(),x:Math.round(r.centerSpringX.target.value),y:Math.round(r.centerSpringY.target.value),zoom:r.zoomSpring.target.value})}},{key:"addAllImageSources",value:function(){var t=this,e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],n=this.props,o=n.nonTiledImages,r=n.infoResponses;Promise.all(r.map((function(e){return t.addTileSource(e)})),o.map((function(image){return t.addNonTiledImage(image)}))).then((function(){(r[0]||o[0])&&(e&&t.zoomToWorld(),t.refreshTileProperties())}))}},{key:"addNonTiledImage",value:function(t){var e=this.props.canvasWorld,n=this.state.viewer,o=t.getProperty("type"),r=t.getProperty("format")||"";return"Image"===o||"dctypes:Image"===o||r.startsWith("image/")?new Promise((function(o,r){n||r(),n.addSimpleImage({error:function(t){return r(t)},fitBounds:vt(x.a.Rect,pt(e.contentResourceToWorldCoordinates(t))),index:e.layerIndexOfImageResource(t),opacity:e.layerOpacityOfImageResource(t),success:function(t){return o(t)},url:t.id})})):Promise.resolve()}},{key:"addTileSource",value:function(t){var e=this.props.canvasWorld,n=this.state.viewer;return new Promise((function(o,r){n||r();var c=wt({},t.json),l=e.contentResource(t.id);l&&n.addTiledImage({error:function(t){return r(t)},fitBounds:vt(x.a.Rect,pt(e.contentResourceToWorldCoordinates(l))),index:e.layerIndexOfImageResource(l),opacity:e.layerOpacityOfImageResource(l),success:function(t){return o(t)},tileSource:c})}))}},{key:"refreshTileProperties",value:function(){for(var t=this.props.canvasWorld,e=this.state.viewer.world,n=[],i=0;i<e.getItemCount();i+=1)n.push(e.getItemAt(i));n.forEach((function(n,i){var o=t.contentResource(n.source["@id"]||n.source.id);if(o){var r=t.layerIndexOfImageResource(o);i!==r&&e.setItemIndex(n,r),n.setOpacity(t.layerOpacityOfImageResource(o))}}))}},{key:"fitBounds",value:function(t,e,n,o){var r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],c=this.state.viewer;c.viewport.fitBounds(new x.a.Rect(t,e,n,o),r)}},{key:"infoResponsesMatch",value:function(t){var e=this.props.infoResponses;return 0===e.length&&0===t.length||e.length===t.length&&e.every((function(e,n){return!!(t[n]&&e.json&&t[n].json&&e.tokenServiceId===t[n].tokenServiceId&&(e.json["@id"]&&e.json["@id"]===t[n].json["@id"]||e.json.id&&e.json.id===t[n].json.id))}))}},{key:"nonTiledImagedMatch",value:function(t){var e=this.props.nonTiledImages;return 0===e.length&&0===t.length||e.some((function(image,e){return!!t[e]&&image.id===t[e].id}))}},{key:"zoomToWorld",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=this.props.canvasWorld;this.fitBounds.apply(this,pt(e.worldBounds()).concat([t]))}},{key:"render",value:function(){var t=this,e=this.props,n=e.children,o=e.classes,label=e.label,r=e.t,c=e.windowId,l=e.drawAnnotations,f=this.state.viewer,d=y.a.Children.map(n,(function(e){return y.a.cloneElement(e,{zoomToWorld:t.zoomToWorld})}));return y.a.createElement(y.a.Fragment,null,y.a.createElement("section",{className:C()(Object(k.a)("osd-container"),o.osdContainer),id:"".concat(c,"-osd"),ref:this.ref,"aria-label":r("item",{label:label}),"aria-live":"polite"},l&&y.a.createElement(ut,{viewer:f,windowId:c}),d,y.a.createElement(ft.a,Object.assign({viewer:f},wt(wt({},this.props),{},{children:null})))))}}],r&&bt(o.prototype,r),c&&bt(o,c),f}(v.Component);Ct.defaultProps={children:null,drawAnnotations:!1,infoResponses:[],label:null,nonTiledImages:[],osdConfig:{},viewerConfig:null};var kt=n(758),St=n(498),Pt={updateViewport:kt.d},Rt=Object(o.compose)(Object(l.a)({osdContainer:{flex:1,position:"relative"}}),Object(c.a)(),Object(r.b)((function(t,e){var n=e.windowId,o=Object(ot.a)(t,{windowId:n}),r=Object(St.q)(t),c=d()(o.canvases.map((function(t){return t.imageServiceIds})));return{canvasWorld:o,drawAnnotations:Object(it.a)(t).window.forceDrawAnnotations||Object(at.e)(t,{content:"annotations",windowId:n}).length>0||Object(at.e)(t,{content:"search",windowId:n}).length>0,infoResponses:c.map((function(t){return r[t]})).filter((function(t){return void 0!==t&&!1===t.isFetching&&void 0===t.error})),label:Object(St.e)(t,{canvasId:(Object(St.g)(t,{windowId:n})||{}).id,windowId:n}),nonTiledImages:Object(St.m)(t,{windowId:n}),osdConfig:Object(it.a)(t).osdConfig,viewerConfig:Object(st.d)(t,{windowId:n})}}),Pt),Object(h.a)("OpenSeadragonViewer"));e.default=Rt(Ct)}}]);